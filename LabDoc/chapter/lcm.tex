\chapter{Life Cycle Management}
\section{Deployment}
In diesem Kapitel geht es um die Pflege, die Bereitstellung sowie das Zurücksetzen des Praktikumversuchs. Sämtliche Schritte wurden mit Ansible-Playbooks
automatisiert.

Folgende Schritte müssen ausgeführt werden, um ein RaspberryPi vorzubereiten.
\begin{itemize}
    \item Installation von Raspbian OS
    \item Anlegen eines Users
    \item Klonen des GitHub Repositorys 
    \item Installation von Ansible
    \item UART auf Raspberry vorbereiten
\end{itemize}

Das Repository kann mit Git und folgendem befehl geklont werden:
\begin{lstlisting}
    git clone https://github.com/nlab4hsrm/ZigbeeHSRM.git
\end{lstlisting}
Am besten wird das Repository direkt in den Homefolder des Users geklont, der später den Versuch durchführt. Damit kann dieser selbständig den Versuch zurücksetzen. Im Anschluss liegt ein Ordner
\grqq ZigbeeHSRM\grqq{} ab. In diesem sind die Playbooks und der LabGuide enthalten.\\
Zusätzlich muss noch Ansible installiert werden:
\begin{lstlisting}
    sudo apt install ansible
\end{lstlisting}

systemctl disable hciuart
disable bt in config


Zum Ausrollen werden die Rollen \grqq Docker\grqq{} und \grqq ZigbeeLab\grqq{} zugewießen. Dies geschieht durch die DeployLabl.yaml.
\begin{lstlisting}
    ansible-playbook ~/ZigbeeHSRM/playbooks/DeployLab.yaml -K -e "channel=<channelnumber>"
\end{lstlisting}
Im Anschluss muss das jeweilige Passwort des Users angegeben werden. Der User benötigt Root Rechte.

Anschließend wird
\begin{itemize}
    \item Docker Installiert.
    \item Die /etc/hosts Einträge gesetzt.
    \item Die Docker Umgebung vorbereitet.
    \item Die Versuchsumgebung mit allen Komponenten gestartet.
\end{itemize}

\section{Zurücksetzen des Versuchs}

Zum zurücksetzen wird das Playbook \grqq ResetLab\grqq{} ausgeführt.

\begin{lstlisting}
    ansible-playbook ~/ZigbeeHSRM/playbooks/ResetLab.yaml -K -e "channel=<channelnumber>"
\end{lstlisting}

\section{Update der eingesetzten Software}

Die RaspberryOS Pakete können mit dem Paktetmanager apt aktuell gehalten werden. Docker zieht initial die Container aus Dockerhub.
Mit folgendem Befehl überprüft Docker das Repository auf aktuelle Container.

\begin{lstlisting}
    docker compose pull /srv/docker-compose.yaml
\end{lstlisting}

Anschließend können die Container mit folgendem Befehl neu gestartet werden.

\begin{lstlisting}
    docker compose up -d /srv/docker-compose.yaml
\end{lstlisting}

Sämtliche Software wird onehin bei jedem Zurücksetzen des Versuchen aktualisiert.

\section{Troubleshooting}

Es empfiehlt sich bei Problemen sich den Log der Container anzuschauen.

\begin{lstlisting}
    docker attach <container-name>
\end{lstlisting}

In der Regel ist es am sinnvollsten, mit dem Log von zigbee2mqtt zu starten. Dieser ist erfahrungsgemäßg bei einer Fehlersuche sehr hilfreich.







